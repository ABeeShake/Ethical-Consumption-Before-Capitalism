---
title: "topicmodeling1.rmd"
author: "shuba"
date: "6/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(tidytext)
library(readtext)
library(x13binary)
library(x12)
#library(stylo)
```


```{r}
raw_data <- read.csv(file = 'A50002.P4.csv')
raw_data2 <- read.csv(file = 'A50007.P4.csv') 
raw_data3 <- read.csv(file = 'A50025.P4.csv') 

wordsonly3 <- raw_data3
wordsonly2 <- raw_data2 
wordsonly <- raw_data
all_text <- merge(wordsonly$text, wordsonly2$text)
all_text <- merge(wordsonly$text, wordsonly3$text)
all_text$text <- paste0(all_text$x,all_text$y)
all_text$text <- paste0(all_text$x,all_text$z)

wordsonly <- rbind(wordsonly, wordsonly2)

wordsonly <- wordsonly %>%
  select(text) %>%
  unnest_tokens(word, text)%>%
  anti_join(stop_words)
wordsonly %>%
count(word, sort = TRUE)

```

```{r}
#library(quanteda)
library(stm)

ethics_sparse <- wordsonly %>%
  count(all_text$text, word, sort = TRUE) %>%
  cast_sparse(all_text$text, word,n)



topic_model <- stm(ethics_sparse, K=3,verbose=FALSE, init.type = "Spectral")
```
```{r}
library(reshape2)
td_beta <- tidy(topic_model)
td_beta %>%
    group_by(topic) %>%
    top_n(10, beta) %>%
    ungroup() %>%
    mutate(topic = paste0("Topic ", topic),
           term = reorder_within(term, beta, topic)) %>%
    ggplot(aes(term, beta, fill = as.factor(topic))) +
    geom_col(alpha = 0.8, show.legend = FALSE) +
    facet_wrap(~ topic, scales = "free_y") +
    coord_flip() +
    scale_x_reordered() +
    labs(x = NULL, y = expression(beta),
         title = "Highest word probabilities for each topic",
         subtitle = "Different words are associated with different topics")

```
```{r}
# td_beta %>%
#     group_by(topic) %>%
#     top_n(10, beta) %>%
#     ungroup() %>%
#     arrange(topic, -beta)
# td_beta <- td_beta %>%
#   mutate(term = reorder(term, beta))%>%
#   ggplot(aes(term,beta,fill = factor(topic)))+
#   geom_col(show.legend = FALSE)+
#   facet_wrap(~ topic, scales = "free")+
#   coord_flip()
```



